{% extends 'main/home.html' %}
{% load crispy_forms_tags %}

{% block header %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  // Load google charts
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);
  
  // Draw the chart and set the chart values
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
    ['Side', 'Average Vote'],
    ['A: ' + {{a_scores}} + ' Votes', {{a_average}}],
    ['B: ' + {{b_scores}} + ' Votes', {{b_average}}],
  ]);
  
    // Optional; add a title and set the width and height of the chart
    var options = {'title':'Current Score', 'width':400, 'height':300, 'backgroundColor':'transparent'};
  
    // Display the chart inside the <div> element with id="piechart"
    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
    chart.draw(data, options);
  }
</script> 
{% endblock %}

{% block content%}
<div class="container">
<div class="jumbotron">
    <h1 style="text-align:center">{{ topic }}</h1><br/>
    <div id="piechart"></div>
</div>
{% if debate_feed %}
    {% for post in debate_feed %}
        {% if post.side == 'A' %}
        <div class="jumbotron" style="background-color:pink">
        {% elif post.side == 'B' %}
        <div class="jumbotron" style="background-color:lightblue">
        {% endif %}
            <h2 style="text-align:center"><b>Side {{ post.side }}</b></h2>
            <h3 style="text-align:center"><b>Posted by {{ post.author }} on {{ post.initial_post_date }}</b></h3>
            <h3 style="text-align:center">
                {% if post.id in scores %}
                    This post has an average score of {{ scores|get_item:post.id }} and has been scored {{ counters|get_item:post.id }} time(s).
                {% else %}
                    This post has not been scored yet. Click "Score Argument" to score it.
                {% endif %}
                </h3>
            <br>
            <p>{{ post.content }}</p>
            <p><a href="{{ post.source }}">Source</a></p>
              <span style="text-align:left; float:left">
                {% if post.id not in scored_arguments %}
                   <p> <a href="/score_post?post_id={{ post.id }}">Score argument</a></p>
                {% else %}
                    <p>You have scored this argument.</p>
                {% endif %}
              </span>
              <span style="text-align:right; float:right">
                {% if post.isReported == False %}
                  <p><a href="/report_argument?post_id={{ post.id }}">Report argument</a></p>
                {% else %}
                  <p>Reported.</p>
                {% endif %}
              </span>
            <br><br>
            <!-- COMMENTS -->
            <div class="jumbotron" style="background-color:white">
            <h4 style="align-self: center"><b>Comments</b></h4>
              {% for key, value in comments.items %}
                  {% if key == post %}
                      {% for item in value %}
                        <hr/>
                          <h5>{{ item.author.username }} -> {{ item.content }}
                            <span style="text-align:right; float:right">
                              {% if item.isReported == False %}
                                <a href="/report_comment?comment_id={{ item.id }}">Report comment</a>
                              {% else %}
                                Reported.
                              {% endif %}
                            </span>
                          </h5>
                      {% endfor %}
                  {% endif %}
              {% endfor %}
            </div>
        </div>
    {% endfor %}
{% endif %}
</div>
{% endblock%}
